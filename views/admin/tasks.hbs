<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {{#if tasks.length}}
        {{#each tasks}}
        <div class="bg-white industrial-border overflow-hidden flex flex-col hover:shadow-lg transition-shadow">
            <!-- Card Header -->
            <div class="bg-[#2F3640] text-white p-4 flex justify-between items-center border-b border-[#7F8C8D]">
                <div class="flex flex-col">
                    <span class="text-[10px] uppercase tracking-widest opacity-70">取件码</span>
                    <span class="text-xl font-bold font-mono">{{this.pickupCode}}</span>
                </div>
                <div class="text-right flex flex-col">
                    <span class="text-[10px] uppercase tracking-widest opacity-70">状态</span>
                    <span class="status-{{this.status}} font-bold text-xs uppercase">
                        {{#if (eq this.status 'pending')}}待处理{{/if}}
                        {{#if (eq this.status 'completed')}}已完成{{/if}}
                    </span>
                </div>
            </div>

            <!-- Card Body -->
            <div class="p-4 flex-1 space-y-4 font-mono text-sm">
                <!-- User Info -->
                <div class="flex justify-between border-b border-[#F5F6FA] pb-2">
                    <span class="text-[#7F8C8D]">用户UID</span>
                    <span class="font-bold text-[#2F3640]">{{#if this.userUid}}{{this.userUid}}{{else}}匿名{{/if}}</span>
                </div>

                <!-- Order Time -->
                <div class="flex justify-between border-b border-[#F5F6FA] pb-2">
                    <span class="text-[#7F8C8D]">下单时间</span>
                    <span class="text-xs text-[#2F3640]">{{formatDate this.createTime}}</span>
                </div>

                <!-- Specs -->
                <div class="border-b border-[#F5F6FA] pb-2">
                    <div class="text-[#7F8C8D] mb-1">打印规格</div>
                    <div class="flex justify-between items-end">
                        <div class="flex flex-col">
                            <span class="font-bold text-[#2F3640]">
                                {{this.color}} | {{this.sides}}{{#if this.needsBinding}} | 需要装订{{/if}}
                            </span>
                        </div>
                        <span class="text-xs text-[#44BD32]">x {{this.copies}} 份</span>
                    </div>
                </div>

                <!-- Files -->
                <div>
                    <div class="text-[#7F8C8D] mb-2">文件列表</div>
                    <div class="grid grid-cols-1 gap-2">
                        {{#each this.files}}
                        <a href="{{this.downloadURL}}" target="_blank" download="{{this.name}}" 
                           class="flex items-center justify-between p-2 bg-[#F5F6FA] border border-transparent hover:border-[#44BD32] transition-colors group"
                           title="{{this.name}}">
                            <div class="flex items-center space-x-2 truncate">
                                <i class="fas {{getFileIcon this.name}}"></i>
                                <span class="truncate text-xs text-[#2F3640]">{{this.name}}</span>
                            </div>
                            <i class="fas fa-download text-[#44BD32] opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </a>
                        {{/each}}
                    </div>
                </div>

                <!-- Remark -->
                {{#if this.remark}}
                <div class="bg-[#F5F6FA] p-2 border-l-4 border-[#7F8C8D]">
                    <span class="text-[10px] text-[#7F8C8D] block uppercase font-bold">备注</span>
                    <p class="text-xs italic text-[#2F3640]">"{{this.remark}}"</p>
                </div>
                {{/if}}
            </div>

            <!-- Card Footer -->
            <div class="p-4 bg-[#F5F6FA]/50 border-t border-[#F5F6FA]">
                <div class="flex gap-2">
                    {{#unless (eq this.status 'completed')}}
                        <a href="/tasks/{{this._id}}/download-all" class="flex-1 flex items-center justify-center space-x-2 py-2 bg-[#F1C40F] text-white hover:bg-[#D4AC0D] transition-colors">
                            <i class="fas fa-file-archive"></i>
                            <span class="text-xs font-bold uppercase">全部下载</span>
                        </a>
                        <form action="/tasks/{{this._id}}/status" method="POST" class="flex-1">
                            <input type="hidden" name="status" value="completed">
                            <button type="submit" class="w-full flex items-center justify-center space-x-2 py-2 bg-[#44BD32] text-white hover:bg-[#27AE60] transition-colors">
                                <i class="fas fa-check"></i>
                                <span class="text-xs font-bold uppercase">完成订单</span>
                            </button>
                        </form>
                    {{else}}
                        <div class="w-full py-2 text-center text-[#7F8C8D] border border-dashed border-[#7F8C8D]">
                            <i class="fas fa-check-double mr-1"></i>
                            已完成
                        </div>
                    {{/unless}}
                </div>
            </div>
        </div>
        {{/each}}
    {{else}}
        <div class="col-span-full py-20 text-center text-[#7F8C8D] uppercase tracking-widest bg-white industrial-border">
            <i class="fas fa-inbox text-4xl mb-4 block opacity-20"></i>
            暂无活跃任务
        </div>
    {{/if}}
</div>
